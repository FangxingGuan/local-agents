<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>NewsBreak æœ¬åœ°AIåŠ©æ‰‹</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
:root {
  --red: #E02020; --dark: #1a1a1a; --gray: #f5f5f7; --gray2: #e8e8e8;
  --text: #333; --text2: #666; --text3: #999; --white: #fff;
  --shadow: 0 2px 12px rgba(0,0,0,0.08); --radius: 16px;
}
body { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI","PingFang SC","Hiragino Sans GB",sans-serif; background:#f0f0f0; display:flex; justify-content:center; min-height:100vh; padding:20px 0; }
.phone { width:430px; max-width:100%; min-height:90vh; background:var(--gray); border-radius:32px; overflow:hidden; position:relative; box-shadow:0 8px 40px rgba(0,0,0,0.15); }
.screen { display:none; min-height:90vh; animation:fadeIn .3s ease; }
.screen.active { display:block; }
@keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }

/* SPLASH */
#splash { background:linear-gradient(135deg,#E02020 0%,#c41818 100%); color:#fff; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:40px 24px; text-align:center; }
#splash.active { display:flex; }
#splash h1 { font-size:32px; font-weight:800; margin-bottom:8px; letter-spacing:-0.5px; }
#splash .subtitle { font-size:16px; opacity:.85; margin-bottom:48px; }
#splash .logo { font-size:56px; margin-bottom:24px; }
.city-grid { display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px; width:100%; max-width:360px; margin-bottom:24px; }
.city-btn { background:rgba(255,255,255,.18); backdrop-filter:blur(8px); border:1.5px solid rgba(255,255,255,.3); color:#fff; padding:16px 8px; border-radius:14px; font-size:14px; font-weight:600; cursor:pointer; transition:all .2s; }
.city-btn:hover { background:rgba(255,255,255,.3); transform:scale(1.04); }
.city-btn .icon { font-size:28px; display:block; margin-bottom:6px; }
.city-btn .name { display:block; }
#splash .hint { font-size:13px; opacity:.6; margin-top:8px; }
.splash-resume { margin-top:24px; background:rgba(255,255,255,.25); border:1.5px solid rgba(255,255,255,.4); color:#fff; padding:14px 28px; border-radius:14px; font-size:15px; font-weight:600; cursor:pointer; display:none; transition:all .2s; }
.splash-resume:hover { background:rgba(255,255,255,.4); }

/* ONBOARDING */
#onboard { background:#fff; padding:0; }
.ob-header { background:var(--red); color:#fff; padding:48px 24px 28px; }
.ob-header h2 { font-size:24px; font-weight:700; }
.ob-header p { font-size:14px; opacity:.8; margin-top:6px; }
.ob-body { padding:24px; }
.ob-section { margin-bottom:28px; }
.ob-section h3 { font-size:15px; font-weight:700; color:var(--text); margin-bottom:12px; }
.topic-grid { display:flex; flex-wrap:wrap; gap:10px; }
.topic-chip { display:flex; align-items:center; gap:6px; padding:10px 16px; border-radius:24px; border:1.5px solid var(--gray2); font-size:14px; cursor:pointer; transition:all .2s; user-select:none; }
.topic-chip.selected { background:var(--red); color:#fff; border-color:var(--red); }
.topic-chip .check { display:none; }
.topic-chip.selected .check { display:inline; }
.ob-input { width:100%; padding:12px 16px; border:1.5px solid var(--gray2); border-radius:12px; font-size:14px; outline:none; transition:border .2s; }
.ob-input:focus { border-color:var(--red); }
.ob-input::placeholder { color:var(--text3); }
.ob-start { width:100%; padding:16px; background:var(--red); color:#fff; border:none; border-radius:14px; font-size:17px; font-weight:700; cursor:pointer; transition:all .2s; }
.ob-start:hover { background:#c41818; transform:scale(1.02); }
.ob-row { display:flex; align-items:center; gap:12px; margin-bottom:12px; }
.ob-toggle { width:48px; height:28px; background:var(--gray2); border-radius:14px; position:relative; cursor:pointer; transition:background .2s; flex-shrink:0; }
.ob-toggle.on { background:var(--red); }
.ob-toggle::after { content:''; position:absolute; top:3px; left:3px; width:22px; height:22px; background:#fff; border-radius:50%; transition:left .2s; box-shadow:0 1px 3px rgba(0,0,0,.2); }
.ob-toggle.on::after { left:23px; }

/* DASHBOARD */
#dashboard { background:var(--gray); padding-bottom:80px; }
.dash-top { background:var(--red); color:#fff; padding:52px 20px 20px; }
.dash-top-row { display:flex; justify-content:space-between; align-items:center; }
.dash-city { font-size:22px; font-weight:700; }
.dash-weather { font-size:14px; opacity:.9; display:flex; align-items:center; gap:6px; }
.dash-date { font-size:13px; opacity:.7; margin-top:4px; }
.dash-prefs { display:flex; gap:6px; margin-top:10px; flex-wrap:wrap; }
.dash-pref-tag { font-size:11px; background:rgba(255,255,255,.2); padding:3px 10px; border-radius:12px; }
.dash-cards { padding:16px; display:flex; flex-direction:column; gap:14px; margin-top:-8px; }
.dash-reset { font-size:12px; opacity:.7; cursor:pointer; text-decoration:underline; }

/* Cards */
.card { background:#fff; border-radius:var(--radius); padding:20px; box-shadow:var(--shadow); transition:all .3s; }
.card.hidden { display:none; }
.card:active { transform:scale(0.98); }
.card-head { display:flex; justify-content:space-between; align-items:center; margin-bottom:14px; }
.card-title { font-size:16px; font-weight:700; color:var(--text); display:flex; align-items:center; gap:8px; }
.card-badge { font-size:11px; background:var(--red); color:#fff; padding:3px 10px; border-radius:20px; font-weight:600; }
.card-badge.green { background:#22c55e; }
.card-badge.orange { background:#f59e0b; }
.card-more { font-size:13px; color:var(--red); font-weight:600; cursor:pointer; }

/* Brief */
.brief-grid { display:grid; grid-template-columns:1fr 1fr 1fr 1fr; gap:8px; margin-bottom:16px; }
.brief-item { text-align:center; padding:10px 4px; background:var(--gray); border-radius:12px; }
.brief-item .val { font-size:18px; font-weight:700; color:var(--text); }
.brief-item .label { font-size:11px; color:var(--text3); margin-top:2px; }
.brief-news { list-style:none; }
.brief-news li { padding:10px 0; border-bottom:1px solid var(--gray); font-size:14px; color:var(--text); line-height:1.5; display:flex; gap:8px; }
.brief-news li:last-child { border:none; }
.brief-news .dot { color:var(--red); font-weight:700; flex-shrink:0; }

/* Commute */
.commute-box { padding:12px; background:var(--gray); border-radius:12px; margin-top:10px; display:flex; align-items:center; gap:10px; }
.commute-box .icon { font-size:24px; }
.commute-box .info { font-size:13px; line-height:1.5; }
.commute-box .info strong { color:var(--text); }

/* Safety */
.safety-items { display:flex; flex-direction:column; gap:10px; }
.safety-item { display:flex; gap:10px; align-items:flex-start; padding:10px 12px; background:var(--gray); border-radius:12px; }
.safety-icon { font-size:20px; flex-shrink:0; width:32px; height:32px; display:flex; align-items:center; justify-content:center; background:#fff; border-radius:8px; }
.safety-text { font-size:13px; color:var(--text); line-height:1.5; }
.safety-text .time { color:var(--text3); font-size:12px; }

/* School */
.school-items { display:flex; flex-direction:column; gap:8px; }
.school-item { display:flex; gap:10px; align-items:flex-start; }
.school-item .icon { font-size:18px; flex-shrink:0; }
.school-item .text { font-size:13px; line-height:1.5; color:var(--text); }
.school-item .text strong { color:var(--dark); }
.school-rating { display:inline-flex; align-items:center; gap:4px; background:#22c55e; color:#fff; padding:4px 10px; border-radius:8px; font-size:12px; font-weight:700; margin-top:10px; }
.school-filter { font-size:12px; color:var(--red); background:var(--gray); padding:4px 10px; border-radius:8px; font-weight:600; }

/* Real estate */
.re-stats { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:14px; }
.re-stat { padding:12px; background:var(--gray); border-radius:12px; }
.re-stat .val { font-size:20px; font-weight:800; color:var(--text); }
.re-stat .label { font-size:11px; color:var(--text3); margin-top:2px; }
.re-stat .change { font-size:12px; font-weight:600; }
.re-stat .change.up { color:#22c55e; }
.re-stat .change.down { color:var(--red); }
.re-chart { height:48px; display:flex; align-items:flex-end; gap:4px; padding:0 4px; }
.re-bar { flex:1; background:var(--red); border-radius:4px 4px 0 0; opacity:.7; transition:height .5s ease; }

/* Events */
.event-items { display:flex; flex-direction:column; gap:10px; }
.event-item { display:flex; gap:12px; align-items:center; }
.event-date { width:48px; height:48px; background:var(--red); color:#fff; border-radius:12px; display:flex; flex-direction:column; align-items:center; justify-content:center; flex-shrink:0; }
.event-date .month { font-size:10px; text-transform:uppercase; opacity:.8; }
.event-date .day { font-size:20px; font-weight:800; }
.event-info .name { font-size:14px; font-weight:600; color:var(--text); }
.event-info .loc { font-size:12px; color:var(--text3); margin-top:2px; }

/* Business */
.biz-items { display:flex; flex-direction:column; gap:12px; }
.biz-item { display:flex; gap:12px; }
.biz-img { width:64px; height:64px; border-radius:12px; flex-shrink:0; display:flex; align-items:center; justify-content:center; font-size:28px; }
.biz-info .name { font-size:14px; font-weight:600; color:var(--text); }
.biz-info .cat { font-size:11px; color:var(--red); font-weight:600; margin-top:1px; }
.biz-info .desc { font-size:12px; color:var(--text2); margin-top:4px; line-height:1.4; }

/* Podcast */
.podcast-card { display:flex; align-items:center; gap:14px; padding:14px; background:var(--gray); border-radius:14px; }
.podcast-play { width:48px; height:48px; background:var(--red); border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; font-size:22px; flex-shrink:0; cursor:pointer; }
.podcast-info .name { font-size:14px; font-weight:600; }
.podcast-info .dur { font-size:12px; color:var(--text3); }
.podcast-wave { flex:1; height:32px; display:flex; align-items:center; gap:2px; }
.podcast-wave span { width:3px; background:var(--red); border-radius:2px; opacity:.5; }

/* Pet */
.pet-items { display:flex; flex-direction:column; gap:10px; }
.pet-item { display:flex; gap:12px; padding:10px 12px; background:var(--gray); border-radius:12px; }
.pet-img { width:48px; height:48px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:24px; background:#fff; flex-shrink:0; }
.pet-info .name { font-size:14px; font-weight:600; color:var(--text); }
.pet-info .desc { font-size:12px; color:var(--text2); margin-top:2px; line-height:1.4; }

/* Gov */
.gov-items { display:flex; flex-direction:column; gap:8px; }
.gov-item { display:flex; gap:10px; align-items:flex-start; }
.gov-item .icon { font-size:18px; flex-shrink:0; }
.gov-item .text { font-size:13px; line-height:1.5; color:var(--text); }

/* Chat */
.chat-fab { position:fixed; bottom:100px; right:50%; transform:translateX(195px); width:56px; height:56px; background:var(--red); color:#fff; border:none; border-radius:50%; font-size:24px; cursor:pointer; box-shadow:0 4px 16px rgba(224,32,32,.4); z-index:100; transition:all .2s; display:none; }
.chat-fab:hover { transform:translateX(195px) scale(1.1); }
.chat-fab.show { display:block; }
#chatOverlay { position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,.5); z-index:200; display:none; justify-content:center; align-items:flex-end; }
#chatOverlay.show { display:flex; }
.chat-panel { width:430px; max-width:100%; height:70vh; background:#fff; border-radius:20px 20px 0 0; display:flex; flex-direction:column; animation:slideUp .3s ease; }
@keyframes slideUp { from{transform:translateY(100%)} to{transform:translateY(0)} }
.chat-header { padding:16px 20px; border-bottom:1px solid var(--gray); display:flex; justify-content:space-between; align-items:center; }
.chat-header h3 { font-size:16px; font-weight:700; }
.chat-close { background:none; border:none; font-size:20px; cursor:pointer; color:var(--text3); padding:4px; }
.chat-messages { flex:1; overflow-y:auto; padding:16px; display:flex; flex-direction:column; gap:12px; }
.chat-msg { max-width:85%; padding:12px 16px; border-radius:16px; font-size:14px; line-height:1.5; animation:msgIn .3s ease; }
@keyframes msgIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }
.chat-msg.bot { background:var(--gray); color:var(--text); align-self:flex-start; border-bottom-left-radius:4px; }
.chat-msg.user { background:var(--red); color:#fff; align-self:flex-end; border-bottom-right-radius:4px; }
.chat-typing { align-self:flex-start; padding:12px 20px; background:var(--gray); border-radius:16px; display:none; }
.chat-typing span { display:inline-block; width:8px; height:8px; background:var(--text3); border-radius:50%; margin:0 2px; animation:bounce .6s infinite alternate; }
.chat-typing span:nth-child(2) { animation-delay:.2s; }
.chat-typing span:nth-child(3) { animation-delay:.4s; }
@keyframes bounce { to{transform:translateY(-6px);opacity:.4} }
.chat-chips { display:flex; flex-wrap:wrap; gap:8px; padding:12px 16px; border-top:1px solid var(--gray); }
.chat-chip { padding:8px 16px; background:var(--gray); border:1.5px solid var(--gray2); border-radius:20px; font-size:13px; cursor:pointer; transition:all .2s; white-space:nowrap; }
.chat-chip:hover { border-color:var(--red); color:var(--red); }
.chat-input-row { display:flex; gap:8px; padding:12px 16px; border-top:1px solid var(--gray); }
.chat-input { flex:1; padding:10px 16px; border:1.5px solid var(--gray2); border-radius:24px; font-size:14px; outline:none; }
.chat-input:focus { border-color:var(--red); }
.chat-send { width:40px; height:40px; background:var(--red); color:#fff; border:none; border-radius:50%; cursor:pointer; font-size:18px; }

/* Tab bar */
.tab-bar { position:fixed; bottom:0; left:50%; transform:translateX(-50%); width:430px; max-width:100%; background:#fff; border-top:1px solid var(--gray2); display:none; padding:8px 0 28px; z-index:50; }
.tab-bar.show { display:flex; justify-content:space-around; }
.tab-item { text-align:center; font-size:10px; color:var(--text3); cursor:pointer; padding:4px 0; }
.tab-item.active { color:var(--red); }
.tab-item .icon { font-size:22px; display:block; margin-bottom:2px; }

/* Toast */
.toast { position:fixed; top:40px; left:50%; transform:translateX(-50%); background:var(--dark); color:#fff; padding:12px 24px; border-radius:12px; font-size:14px; z-index:300; display:none; animation:fadeIn .3s; }
.toast.show { display:block; }

/* Source links */
.news-link { color:var(--text); text-decoration:none; transition:color .2s; }
.news-link:hover { color:var(--red); }
.src-link { color:var(--red); font-size:11px; font-weight:600; opacity:.8; }
.safety-item[onclick], .school-item[onclick], .event-item[onclick], .biz-item[onclick], .gov-item[onclick], .pet-item[onclick] { cursor:pointer; transition:background .2s; }
.safety-item[onclick]:hover, .pet-item[onclick]:hover { background:var(--gray2); }
.school-item[onclick]:hover .text, .gov-item[onclick]:hover .text { color:var(--red); }
.event-item[onclick]:hover .name, .biz-item[onclick]:hover .name { color:var(--red); }

/* RE card source */
.re-source { font-size:11px; color:var(--text3); margin-top:8px; }
</style>
</head>
<body>

<div class="phone" id="app">
  <!-- SPLASH -->
  <div class="screen active" id="splash">
    <div class="logo">ğŸ“°</div>
    <h1>NewsBreak</h1>
    <div class="subtitle">æœ¬åœ°AIåŠ©æ‰‹ Â· ä½ çš„åŸå¸‚ï¼Œä½ å®šåˆ¶</div>
    <div class="city-grid">
      <button class="city-btn" onclick="selectCity('Palo Alto')"><span class="icon">ğŸŒ²</span><span class="name">Palo Alto</span></button>
      <button class="city-btn" onclick="selectCity('Mountain View')"><span class="icon">â›°ï¸</span><span class="name">Mountain View</span></button>
      <button class="city-btn" onclick="selectCity('San Jose')"><span class="icon">ğŸ™ï¸</span><span class="name">San Jose</span></button>
      <button class="city-btn" onclick="selectCity('Sunnyvale')"><span class="icon">â˜€ï¸</span><span class="name">Sunnyvale</span></button>
      <button class="city-btn" onclick="selectCity('San Francisco')"><span class="icon">ğŸŒ‰</span><span class="name">San Francisco</span></button>
      <button class="city-btn" onclick="selectCity('Menlo Park')"><span class="icon">ğŸ¡</span><span class="name">Menlo Park</span></button>
    </div>
    <button class="splash-resume" id="resumeBtn" onclick="resumeSession()">ğŸ“ ç»§ç»­ä½¿ç”¨ <span id="resumeCity"></span></button>
    <div class="hint">é€‰æ‹©ä½ çš„åŸå¸‚ï¼Œå¼€å¯ä¸ªæ€§åŒ–æœ¬åœ°åŠ©æ‰‹</div>
  </div>

  <!-- ONBOARDING -->
  <div class="screen" id="onboard">
    <div class="ob-header">
      <h2>ğŸ‘‹ å®šåˆ¶ä½ çš„ <span id="obCity">Palo Alto</span> åŠ©æ‰‹</h2>
      <p>é€‰æ‹©å…³æ³¨å†…å®¹ï¼ŒAIä¸ºä½ æ¯æ—¥ç”Ÿæˆ</p>
    </div>
    <div class="ob-body">
      <div class="ob-section">
        <h3>ğŸ“Œ é€‰æ‹©å…³æ³¨è¯é¢˜</h3>
        <div class="topic-grid" id="topicGrid">
          <div class="topic-chip selected" data-topic="weather" onclick="toggleTopic(this)"><span class="check">âœ“ </span>ğŸŒ¤ï¸ å¤©æ°”</div>
          <div class="topic-chip selected" data-topic="safety" onclick="toggleTopic(this)"><span class="check">âœ“ </span>ğŸ›¡ï¸ å®‰å…¨</div>
          <div class="topic-chip selected" data-topic="school" onclick="toggleTopic(this)"><span class="check">âœ“ </span>ğŸ« å­¦åŒº</div>
          <div class="topic-chip" data-topic="realestate" onclick="toggleTopic(this)"><span class="check">âœ“ </span>ğŸ  æˆ¿äº§</div>
          <div class="topic-chip" data-topic="events" onclick="toggleTopic(this)"><span class="check">âœ“ </span>ğŸ“… æ´»åŠ¨</div>
          <div class="topic-chip" data-topic="business" onclick="toggleTopic(this)"><span class="check">âœ“ </span>ğŸª å•†å®¶</div>
          <div class="topic-chip" data-topic="podcast" onclick="toggleTopic(this)"><span class="check">âœ“ </span>ğŸ™ï¸ æ’­å®¢</div>
          <div class="topic-chip" data-topic="gov" onclick="toggleTopic(this)"><span class="check">âœ“ </span>ğŸ›ï¸ æ”¿åºœ</div>
          <div class="topic-chip" data-topic="pet" onclick="toggleTopic(this)"><span class="check">âœ“ </span>ğŸ¾ å® ç‰©</div>
        </div>
      </div>
      <div class="ob-section">
        <h3>ğŸ« å…³æ³¨çš„å­¦æ ¡ï¼ˆå¯é€‰ï¼‰</h3>
        <input class="ob-input" id="obSchool" placeholder="ä¾‹å¦‚ï¼šGunn High School">
      </div>
      <div class="ob-section">
        <h3>ğŸš— é€šå‹¤è·¯çº¿ï¼ˆå¯é€‰ï¼‰</h3>
        <input class="ob-input" id="obCommute" placeholder="ä¾‹å¦‚ï¼šPalo Alto â†’ Mountain View">
      </div>
      <div class="ob-section">
        <h3>â° æ¨é€æ—¶é—´</h3>
        <div class="ob-row">
          <input class="ob-input" type="time" id="obTime" value="07:00" style="width:120px">
          <span style="font-size:14px;color:var(--text2)">æ¯æ—¥æ—©é—´é€Ÿè§ˆ</span>
        </div>
      </div>
      <button class="ob-start" onclick="saveAndStart()">ğŸš€ å¼€å§‹ä½¿ç”¨</button>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div class="screen" id="dashboard">
    <div class="dash-top">
      <div class="dash-top-row">
        <div>
          <div class="dash-city" id="dashCity">ğŸ“ Palo Alto</div>
          <div class="dash-date" id="dashDate"></div>
        </div>
        <div style="text-align:right">
          <div class="dash-weather">â˜€ï¸ 75Â°F Â· AQI 59</div>
          <div class="dash-reset" onclick="resetPrefs()">âš™ï¸ é‡æ–°è®¾ç½®</div>
        </div>
      </div>
      <div class="dash-prefs" id="dashPrefs"></div>
    </div>
    <div class="dash-cards" id="dashCards">

      <!-- ä»Šæ—¥é€Ÿè§ˆ (always show) -->
      <div class="card" data-card="weather">
        <div class="card-head">
          <div class="card-title">â˜€ï¸ ä»Šæ—¥é€Ÿè§ˆ</div>
          <span class="card-badge green">AIç”Ÿæˆ</span>
        </div>
        <div class="brief-grid">
          <div class="brief-item"><div class="val">75Â°</div><div class="label">æ¸©åº¦</div></div>
          <div class="brief-item"><div class="val" style="color:#f59e0b">59</div><div class="label">AQI</div></div>
          <div class="brief-item"><div class="val">5.3</div><div class="label">UV</div></div>
          <div class="brief-item"><div class="val" style="color:#22c55e">0%</div><div class="label">é™æ°´</div></div>
        </div>
        <ul class="brief-news">
          <li><span class="dot">â€¢</span><a href="https://www.paloaltoonline.com/palo-alto/2026/02/25/chinese-tea-chain-plans-bay-area-debut-in-downtown-palo-alto/" target="_blank" class="news-link">ğŸµ æ²ªä¸Šé˜¿å§¨å°†åœ¨University Aveå¼€æ¹¾åŒºé¦–åº—ï¼Œä»Šå¤å¼€ä¸š</a></li>
          <li><span class="dot">â€¢</span><a href="https://www.pausd.org/about-us/superintendent-search" target="_blank" class="news-link">ğŸ« PAUSDå¯åŠ¨æ–°æ€»ç›‘æœç´¢ï¼Œå‘5-7å®¶å…¬å¸å¾é›†ææ¡ˆ</a></li>
          <li><span class="dot">â€¢</span><a href="https://www.paloaltoonline.com/city-government/2026/02/24/palo-alto-leans-on-reserves-to-plug-growing-budget-hole/" target="_blank" class="news-link">ğŸ’° å¸‚æ”¿åºœåŠ¨ç”¨$1000ä¸‡+å‚¨å¤‡é‡‘å¡«é¢„ç®—ç¼ºå£</a></li>
        </ul>
        <div class="commute-box" id="commuteBox" style="display:none">
          <div class="icon">ğŸš—</div>
          <div class="info"><strong id="commuteRoute">PA â†’ MV</strong><br>El Camino 22min Â· Hwy 101 18min(è½»å¾®æ‹¥å µ) Â· Central Expy 20min</div>
        </div>
      </div>

      <!-- æ’­å®¢ -->
      <div class="card" data-card="podcast">
        <div class="card-head">
          <div class="card-title">ğŸ™ï¸ ä»Šæ—¥æ’­å®¢</div>
          <span class="card-badge">3åˆ†é’Ÿ</span>
        </div>
        <div class="podcast-card">
          <div class="podcast-play">â–¶</div>
          <div><div class="podcast-info"><div class="name" id="podName">Palo Alto æ—©é—´æ–°é—»</div><div class="dur">AIè¯­éŸ³ Â· 2æœˆ27æ—¥</div></div></div>
          <div class="podcast-wave" id="podWave"></div>
        </div>
      </div>

      <!-- å®‰å…¨ -->
      <div class="card" data-card="safety">
        <div class="card-head">
          <div class="card-title">ğŸ›¡ï¸ å®‰å…¨æŠ¥å‘Š</div>
          <span class="card-badge orange">æœ¬å‘¨ 3èµ·</span>
        </div>
        <div class="safety-items">
          <div class="safety-item" onclick="window.open('https://www.paloaltoonline.com/crime/2026/02/26/palo-alto-police-seek-suspect-in-downtown-sexual-battery/','_blank')"><div class="safety-icon">âš ï¸</div><div class="safety-text">Downtown University Ave æ€§éªšæ‰°æ¡ˆï¼Œå«ŒçŠ¯åœ¨é€ƒ<br><span class="time">2/19 Â· 200 University Ave Â· <span class="src-link">Palo Alto Online â†—</span></span></div></div>
          <div class="safety-item" onclick="window.open('https://patch.com/california/paloalto/man-arrested-attempted-robbery-teen-bus-depot','_blank')"><div class="safety-icon">ğŸ”“</div><div class="safety-text">60å²ç”·å­å…¬äº¤ç«™å°æŠ¢åŠ«é«˜ä¸­ç”Ÿï¼Œå·²è¢«é€®æ•<br><span class="time">æœ¬å‘¨ Â· 95 University Ave Â· <span class="src-link">Patch â†—</span></span></div></div>
          <div class="safety-item" onclick="window.open('https://www.uscrimeradar.com/palo-alto-ca','_blank')"><div class="safety-icon">ğŸš¨</div><div class="safety-text">åœè½¦åœºç­ç«å™¨æ”»å‡»äº‹ä»¶<br><span class="time">2/26 Â· å¸‚ä¸­å¿ƒåœè½¦åœº Â· <span class="src-link">CrimeRadar â†—</span></span></div></div>
        </div>
        <div style="margin-top:12px"><span class="card-more">æŸ¥çœ‹å®Œæ•´æŠ¥å‘Š â†’</span></div>
      </div>

      <!-- å­¦åŒº -->
      <div class="card" data-card="school">
        <div class="card-head">
          <div class="card-title">ğŸ« <span id="schoolTitle">PAUSD å­¦åŒºåŠ¨æ€</span></div>
          <span class="card-badge" id="schoolBadge">å®¶é•¿å¿…çœ‹</span>
        </div>
        <div id="schoolFilterTag" style="margin-bottom:10px;display:none"><span class="school-filter">ğŸ¯ åªè¿½è¸ª: <span id="schoolFilterName"></span></span></div>
        <div class="school-items">
          <div class="school-item" onclick="window.open('https://www.pausd.org/about-us/superintendent-search','_blank')"><div class="icon">ğŸ“¢</div><div class="text"><strong>æ–°æ€»ç›‘æœç´¢å¯åŠ¨</strong> â€” Boardå‘5-7å®¶æœç´¢å…¬å¸å¾é›†ææ¡ˆ <span class="src-link">PAUSD â†—</span></div></div>
          <div class="school-item" onclick="window.open('https://www.paloaltoonline.com/palo-alto-schools/2026/02/11/facing-criticism-palo-alto-schools-prepare-to-reverse-staff-cuts/','_blank')"><div class="icon">âœ…</div><div class="text"><strong>è£å‘˜è®¡åˆ’è¢«æ¨ç¿»</strong> â€” 5-0å…¨ç¥¨ä¿ç•™é˜…è¯»/æ•°å­¦ä¸“å®¶ <span class="src-link">PA Online â†—</span></div></div>
          <div class="school-item" onclick="window.open('https://www.pausd.org/about-us/news/all/news/~board/sup/post/superintendents-update-february-13-2026-1771010450367','_blank')"><div class="icon">ğŸ’”</div><div class="text"><strong>å¿ƒç†å¥åº·æ”¯æŒ</strong> â€” Uwillæä¾›3æ¬¡å…è´¹è¿œç¨‹å’¨è¯¢ <span class="src-link">PAUSD â†—</span></div></div>
          <div class="school-item" onclick="window.open('https://www.paloaltoonline.com/palo-alto-schools/2026/02/18/teacher-reaches-multi-million-dollar-settlement-in-lawsuit-against-school-district/','_blank')"><div class="icon">ğŸ’°</div><div class="text"><strong>$325ä¸‡å’Œè§£</strong> â€” å‰Fletcherä¸­å­¦æ•™å¸ˆæ€§ä¾µæ¡ˆ <span class="src-link">PA Online â†—</span></div></div>
        </div>
        <div class="school-rating">â­ GreatSchools 8-10/10 Â· 20æ‰€å­¦æ ¡</div>
      </div>

      <!-- æˆ¿äº§ -->
      <div class="card" data-card="realestate">
        <div class="card-head">
          <div class="card-title">ğŸ  æˆ¿äº§å‘¨æŠ¥</div>
          <span class="card-more">è¯¦æƒ… â†’</span>
        </div>
        <div class="re-stats">
          <div class="re-stat"><div class="val">$2.6M</div><div class="label">ç‹¬æ ‹æˆ¿ä¸­ä½ä»·</div><div class="change up">â†‘ 4.6% YoY</div></div>
          <div class="re-stat"><div class="val">7å¤©</div><div class="label">å¹³å‡å”®å‡ºå¤©æ•°</div><div class="change down">å–æ–¹å¸‚åœº</div></div>
          <div class="re-stat"><div class="val">107%</div><div class="label">æˆäº¤/æŒ‚ç‰Œæ¯”</div><div class="change up">é¢‘ç¹è¶…ä»·</div></div>
          <div class="re-stat"><div class="val">18å¥—</div><div class="label">åœ¨å”®æˆ¿æº</div><div class="change">åº“å­˜ç´§å¼ </div></div>
        </div>
        <div style="font-size:12px;color:var(--text3);margin-bottom:6px">è¿‘6æœˆæˆ¿ä»·è¶‹åŠ¿</div>
        <div class="re-chart" id="reChart"></div>
        <div class="re-source">æ•°æ®æ¥æº: <a href="https://www.zillow.com/home-values/32999/palo-alto-ca/" target="_blank" class="src-link">Zillow</a> Â· <a href="https://www.redfin.com/city/14141/CA/Palo-Alto/housing-market" target="_blank" class="src-link">Redfin</a> Â· <a href="https://www.freddiemac.com/pmms" target="_blank" class="src-link">Freddie Mac</a></div>
      </div>

      <!-- æ´»åŠ¨ -->
      <div class="card" data-card="events">
        <div class="card-head">
          <div class="card-title">ğŸ“… æœ¬å‘¨æ´»åŠ¨</div>
          <span class="card-more">å…¨éƒ¨ â†’</span>
        </div>
        <div class="event-items">
          <div class="event-item" onclick="window.open('https://www.gamblegarden.org','_blank')"><div class="event-date"><div class="month">2æœˆ</div><div class="day">28</div></div><div class="event-info"><div class="name">ğŸŒ± Gamble Garden å›­è‰ºå·¥ä½œåŠ</div><div class="loc">10AM Â· 1431 Waverley St Â· <span class="src-link">è¯¦æƒ… â†—</span></div></div></div>
          <div class="event-item" onclick="window.open('https://www.eventbrite.com/e/2026-palo-alto-lunar-new-year-fair-tickets-1981489666934','_blank')"><div class="event-date"><div class="month">3æœˆ</div><div class="day">1</div></div><div class="event-info"><div class="name">ğŸ® å…ƒå®µèŠ‚å®¶åº­å˜‰å¹´å</div><div class="loc">11AM Â· Mitchell Park Â· <span class="src-link">Eventbrite â†—</span></div></div></div>
          <div class="event-item" onclick="window.open('https://gostanford.com/sports/womens-basketball','_blank')"><div class="event-date"><div class="month">3æœˆ</div><div class="day">1</div></div><div class="event-info"><div class="name">ğŸ€ Stanfordå¥³ç¯® vs Clemson</div><div class="loc">TBD Â· Maples Pavilion Â· <span class="src-link">GoStanford â†—</span></div></div></div>
        </div>
      </div>

      <!-- å•†å®¶ -->
      <div class="card" data-card="business">
        <div class="card-head">
          <div class="card-title">ğŸª å•†å®¶èšç„¦</div>
          <span class="card-badge green">æ–°å¼€ä¸š</span>
        </div>
        <div class="biz-items">
          <div class="biz-item" onclick="window.open('https://www.sfbayareatimes.com/posts/bay-area-dining-openings-february-2026-weekend-getaways','_blank')"><div class="biz-img" style="background:#fff3f3">ğŸ£</div><div class="biz-info"><div class="name">Yutori</div><div class="cat">æ—¥æœ¬é¤å… Â· 2æœˆåº•å¼€ä¸š</div><div class="desc">å‰Googleé¦–å¸­å¯¿å¸å¨å¸ˆï¼Œ5000sqftæ—¥æœ¬ç”Ÿæ´»æ–¹å¼ç©ºé—´ <span class="src-link">SF Bay Area Times â†—</span></div></div></div>
          <div class="biz-item" onclick="window.open('https://nationaltoday.com/us/ca/palo-alto/news/2026/02/26/new-palo-alto-restaurant-offers-all-you-can-eat-kebabs-and-mezes/','_blank')"><div class="biz-img" style="background:#f3fff3">ğŸ¥™</div><div class="biz-info"><div class="name">All-You-Can-Eat Kebabs</div><div class="cat">åœ°ä¸­æµ· Â· å·²å¼€ä¸š</div><div class="desc">å·´è¥¿çƒ¤è‚‰å¼æœåŠ¡ï¼Œæ— é™é‡çƒ¤ä¸²å’Œå°èœ <span class="src-link">National Today â†—</span></div></div></div>
          <div class="biz-item" onclick="window.open('https://www.paloaltoonline.com/palo-alto/2026/02/25/chinese-tea-chain-plans-bay-area-debut-in-downtown-palo-alto/','_blank')"><div class="biz-img" style="background:#f3f3ff">ğŸµ</div><div class="biz-info"><div class="name">æ²ªä¸Šé˜¿å§¨ (Auntea Jenny)</div><div class="cat">é²œæœèŒ¶ Â· ä»Šå¤å¼€ä¸š</div><div class="desc">å…¨çƒ10000+é—¨åº—ï¼Œæ¹¾åŒºé¦–åº—åœ¨University Ave <span class="src-link">PA Online â†—</span></div></div></div>
        </div>
      </div>

      <!-- æ”¿åºœ -->
      <div class="card" data-card="gov">
        <div class="card-head">
          <div class="card-title">ğŸ›ï¸ æ”¿åºœåŠ¨æ€</div>
          <span class="card-more">è¯¦æƒ… â†’</span>
        </div>
        <div class="gov-items">
          <div class="gov-item" onclick="window.open('https://www.paloaltoonline.com/city-government/2026/02/24/palo-alto-leans-on-reserves-to-plug-growing-budget-hole/','_blank')"><div class="icon">ğŸ’°</div><div class="text"><strong>é¢„ç®—ç¼ºå£$1000ä¸‡+</strong> â€” åŠ¨ç”¨å‚¨å¤‡é‡‘ <span class="src-link">PA Online â†—</span></div></div>
          <div class="gov-item" onclick="window.open('https://www.paloaltoonline.com/land-use/2026/02/12/commissioners-pan-barron-park-housing-project-over-traffic-impacts/','_blank')"><div class="icon">ğŸ—ï¸</div><div class="text"><strong>Barron Park 321æˆ·å…¬å¯“è¢«å¦</strong> â€” äº¤é€šå®‰å…¨ <span class="src-link">PA Online â†—</span></div></div>
          <div class="gov-item" onclick="window.open('https://www.paloaltoonline.com/city-government/2026/02/10/palo-alto-to-explore-closing-churchill-rail-crossing-at-communitys-urging/','_blank')"><div class="icon">ğŸš‡</div><div class="text"><strong>Churchillé“è·¯é“å£å…³é—­è®¨è®º</strong> â€” åŠ é€Ÿæ¨è¿› <span class="src-link">PA Online â†—</span></div></div>
          <div class="gov-item" onclick="window.open('https://www.paloaltoonline.com/business/2026/02/04/city-to-create-retail-zones-on-el-camino-amid-housing-influx/','_blank')"><div class="icon">ğŸª</div><div class="text"><strong>El Caminoé›¶å”®ä¿æŠ¤åŒº</strong> â€” é˜²å•†ä¸šè¢«ä½å®…å–ä»£ <span class="src-link">PA Online â†—</span></div></div>
        </div>
      </div>

      <!-- å® ç‰© -->
      <div class="card" data-card="pet">
        <div class="card-head">
          <div class="card-title">ğŸ¾ å® ç‰©ä¿¡æ¯</div>
          <span class="card-badge green">é¢†å…»</span>
        </div>
        <div class="pet-items">
          <div class="pet-item" onclick="window.open('https://sfbay.craigslist.org/pen/pet/d/palo-alto-american-eskimo-miniature/7913519416.html','_blank')"><div class="pet-img">ğŸ•</div><div class="pet-info"><div class="name">American Eskimo è¿·ä½ å‹</div><div class="desc">Palo Alto Â· å…è´¹é¢†å…» <span class="src-link">Craigslist â†—</span></div></div></div>
          <div class="pet-item" onclick="window.open('https://www.lostmykitty.com/missing-pets.cfm?zipcode=94303','_blank')"><div class="pet-img">ğŸˆ</div><div class="pet-info"><div class="name">èµ°å¤±çŒ« "Simba"</div><div class="desc">é‡‘è‰²çŸ­æ¯› Â· 94303 Â· 1/24èµ°å¤± <span class="src-link">LostMyKitty â†—</span></div></div></div>
          <div class="pet-item" onclick="window.open('https://pet911.org/east-palo-alto/lost-dogs','_blank')"><div class="pet-img">ğŸ¶</div><div class="pet-info"><div class="name">èµ°å¤± Swiss Shepherdå¹¼çŠ¬</div><div class="desc">ç™½è‰² Â· East Palo Alto Â· 2/9èµ°å¤± <span class="src-link">Pet911 â†—</span></div></div></div>
        </div>
        <div style="margin-top:10px;font-size:12px;color:var(--text3)">ğŸ“ Pets In Need (650) 496-5971</div>
      </div>

    </div>
  </div>
</div>

<!-- Chat FAB -->
<button class="chat-fab" id="chatFab" onclick="openChat()">ğŸ’¬</button>

<!-- Chat Overlay -->
<div id="chatOverlay">
  <div class="chat-panel">
    <div class="chat-header">
      <h3>ğŸ¤– å®šåˆ¶ä½ çš„åŠ©æ‰‹</h3>
      <button class="chat-close" onclick="closeChat()">âœ•</button>
    </div>
    <div class="chat-messages" id="chatMsgs">
      <div class="chat-msg bot">ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„æœ¬åœ°AIåŠ©æ‰‹ã€‚å‘Šè¯‰æˆ‘ä½ æƒ³å…³æ³¨ä»€ä¹ˆï¼Œæˆ‘æ¥å¸®ä½ å®šåˆ¶ âœ¨<br><br>ä½ çš„è®¾ç½®ä¼šè‡ªåŠ¨ä¿å­˜ï¼Œä¸‹æ¬¡æ‰“å¼€ç»§ç»­ç”Ÿæ•ˆã€‚</div>
    </div>
    <div class="chat-typing" id="chatTyping"><span></span><span></span><span></span></div>
    <div class="chat-chips" id="chatChips">
      <div class="chat-chip" onclick="sendChip(this)" data-action="school:Gunn High School">åªå…³æ³¨Gunn High School</div>
      <div class="chat-chip" onclick="sendChip(this)" data-action="time:07:00">æ¯å¤©æ—©ä¸Š7ç‚¹æ¨é€</div>
      <div class="chat-chip" onclick="sendChip(this)" data-action="commute:PAâ†’MV">åŠ ä¸Šé€šå‹¤è·¯å†µ PAâ†’MV</div>
      <div class="chat-chip" onclick="sendChip(this)" data-action="topic:pet">å…³æ³¨å® ç‰©é¢†å…»ä¿¡æ¯</div>
      <div class="chat-chip" onclick="sendChip(this)" data-action="topic:realestate">å¼€å¯æˆ¿äº§å‘¨æŠ¥</div>
      <div class="chat-chip" onclick="sendChip(this)" data-action="topic:gov">å¼€å¯æ”¿åºœåŠ¨æ€</div>
    </div>
    <div class="chat-input-row">
      <input class="chat-input" id="chatInput" placeholder="è¾“å…¥ä½ çš„éœ€æ±‚..." onkeydown="if(event.key==='Enter')sendMsg()">
      <button class="chat-send" onclick="sendMsg()">â†‘</button>
    </div>
  </div>
</div>

<!-- Tab Bar -->
<div class="tab-bar" id="tabBar">
  <div class="tab-item active"><span class="icon">ğŸ </span>é¦–é¡µ</div>
  <div class="tab-item"><span class="icon">ğŸ”</span>å‘ç°</div>
  <div class="tab-item"><span class="icon">ğŸ“°</span>æ–°é—»</div>
  <div class="tab-item" onclick="openChat()"><span class="icon">ğŸ¤–</span>AIåŠ©æ‰‹</div>
  <div class="tab-item" onclick="resetPrefs()"><span class="icon">ğŸ‘¤</span>æˆ‘çš„</div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
// === STATE ===
const STORAGE_KEY = 'nb_agent_prefs';
let prefs = loadPrefs();

function defaultPrefs() {
  return { city:'', topics:['weather','safety','school'], school:'', commute:'', time:'07:00', chatHistory:[] };
}

function loadPrefs() {
  try { const s = localStorage.getItem(STORAGE_KEY); return s ? JSON.parse(s) : defaultPrefs(); }
  catch(e) { return defaultPrefs(); }
}

function savePrefs() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(prefs));
}

// === INIT ===
window.onload = function() {
  if (prefs.city) {
    document.getElementById('resumeBtn').style.display = 'block';
    document.getElementById('resumeCity').textContent = prefs.city;
  }
};

function resumeSession() {
  renderDashboard();
}

// === SPLASH ===
function selectCity(city) {
  prefs.city = city;
  document.getElementById('obCity').textContent = city;
  // Restore topic selections in onboarding
  document.querySelectorAll('#topicGrid .topic-chip').forEach(c => {
    const t = c.dataset.topic;
    if (prefs.topics.includes(t)) c.classList.add('selected');
    else c.classList.remove('selected');
  });
  if (prefs.school) document.getElementById('obSchool').value = prefs.school;
  if (prefs.commute) document.getElementById('obCommute').value = prefs.commute;
  if (prefs.time) document.getElementById('obTime').value = prefs.time;
  showScreen('onboard');
}

function toggleTopic(el) { el.classList.toggle('selected'); }

function saveAndStart() {
  // Collect topics
  prefs.topics = [];
  document.querySelectorAll('#topicGrid .topic-chip.selected').forEach(c => {
    prefs.topics.push(c.dataset.topic);
  });
  prefs.school = document.getElementById('obSchool').value.trim();
  prefs.commute = document.getElementById('obCommute').value.trim();
  prefs.time = document.getElementById('obTime').value;
  savePrefs();
  renderDashboard();
}

// === DASHBOARD ===
function renderDashboard() {
  document.getElementById('dashCity').textContent = 'ğŸ“ ' + prefs.city;
  const d = new Date();
  const days = ['å‘¨æ—¥','å‘¨ä¸€','å‘¨äºŒ','å‘¨ä¸‰','å‘¨å››','å‘¨äº”','å‘¨å…­'];
  document.getElementById('dashDate').textContent = `${d.getFullYear()}å¹´${d.getMonth()+1}æœˆ${d.getDate()}æ—¥ ${days[d.getDay()]}`;

  // Pref tags
  const tagMap = {weather:'ğŸŒ¤ï¸å¤©æ°”',safety:'ğŸ›¡ï¸å®‰å…¨',school:'ğŸ«å­¦åŒº',realestate:'ğŸ æˆ¿äº§',events:'ğŸ“…æ´»åŠ¨',business:'ğŸªå•†å®¶',podcast:'ğŸ™ï¸æ’­å®¢',gov:'ğŸ›ï¸æ”¿åºœ',pet:'ğŸ¾å® ç‰©'};
  const prefsDiv = document.getElementById('dashPrefs');
  prefsDiv.innerHTML = prefs.topics.map(t => `<span class="dash-pref-tag">${tagMap[t]||t}</span>`).join('');
  if (prefs.school) prefsDiv.innerHTML += `<span class="dash-pref-tag">ğŸ¯${prefs.school}</span>`;
  if (prefs.commute) prefsDiv.innerHTML += `<span class="dash-pref-tag">ğŸš—${prefs.commute}</span>`;

  // Show/hide cards based on topics
  document.querySelectorAll('#dashCards .card').forEach(card => {
    const ct = card.dataset.card;
    if (!ct) return;
    // weather card always shows if any topic selected
    if (ct === 'weather') { card.classList.remove('hidden'); return; }
    if (prefs.topics.includes(ct)) card.classList.remove('hidden');
    else card.classList.add('hidden');
  });

  // Commute
  if (prefs.commute) {
    document.getElementById('commuteBox').style.display = 'flex';
    document.getElementById('commuteRoute').textContent = prefs.commute;
  } else {
    document.getElementById('commuteBox').style.display = 'none';
  }

  // School filter
  if (prefs.school) {
    document.getElementById('schoolFilterTag').style.display = 'block';
    document.getElementById('schoolFilterName').textContent = prefs.school;
    document.getElementById('schoolBadge').textContent = prefs.school;
  } else {
    document.getElementById('schoolFilterTag').style.display = 'none';
    document.getElementById('schoolBadge').textContent = 'å®¶é•¿å¿…çœ‹';
  }

  // Podcast name
  document.getElementById('podName').textContent = prefs.city + ' æ—©é—´æ–°é—»';

  showScreen('dashboard');
  document.getElementById('chatFab').classList.add('show');
  document.getElementById('tabBar').classList.add('show');
  initCharts();

  // Restore chat history
  if (prefs.chatHistory && prefs.chatHistory.length) {
    const msgs = document.getElementById('chatMsgs');
    prefs.chatHistory.forEach(m => {
      const div = document.createElement('div');
      div.className = 'chat-msg ' + m.type;
      div.innerHTML = m.text;
      msgs.appendChild(div);
    });
  }
}

function initCharts() {
  const heights = [65,70,68,75,78,82];
  const chart = document.getElementById('reChart');
  chart.innerHTML = '';
  heights.forEach((h,i) => {
    const bar = document.createElement('div');
    bar.className = 'bar re-bar';
    bar.style.height = '0';
    chart.appendChild(bar);
    setTimeout(() => bar.style.height = h+'%', 100+i*80);
  });
  const wave = document.getElementById('podWave');
  wave.innerHTML = '';
  for(let i=0;i<24;i++) {
    const s = document.createElement('span');
    s.style.height = (8+Math.random()*22)+'px';
    wave.appendChild(s);
  }
}

function resetPrefs() {
  if(confirm('é‡æ–°è®¾ç½®åå¥½ï¼Ÿä½ çš„èŠå¤©è®°å½•å°†ä¿ç•™ã€‚')) {
    const hist = prefs.chatHistory;
    prefs = defaultPrefs();
    prefs.chatHistory = hist;
    savePrefs();
    document.getElementById('chatFab').classList.remove('show');
    document.getElementById('tabBar').classList.remove('show');
    document.getElementById('resumeBtn').style.display = 'none';
    showScreen('splash');
  }
}

// === CHAT ===
const responses = {
  'school:Gunn High School': { text:'âœ… å·²è®¾ç½®ï¼å­¦åŒºåŠ¨æ€å°†åªè¿½è¸ª <strong>Gunn High School</strong>ï¼š\n\nâ€¢ æ ¡è‘£ä¼šæ¶‰åŠGunnçš„å†³è®®\nâ€¢ Gunnè€ƒè¯•æˆç»©å’Œæ’å\nâ€¢ åœè¯¾/å»¶è¿Ÿé€šçŸ¥\nâ€¢ Gunnç›¸å…³æ´»åŠ¨\n\nè®¾ç½®å·²ä¿å­˜ï¼Œä¸‹æ¬¡æ‰“å¼€ç»§ç»­ç”Ÿæ•ˆã€‚', action: ()=>{ prefs.school='Gunn High School'; savePrefs(); applySchoolFilter(); }},
  'time:07:00': { text:'â° å·²è®¾ç½®ï¼æ¯å¤©æ—©ä¸Š <strong>7:00 AM</strong> æ¨é€ä¸ªæ€§åŒ–é€Ÿè§ˆï¼š\n\nâ˜€ï¸ å¤©æ°”+AQI\nğŸ“° Top 3æœ¬åœ°æ–°é—»\nğŸ›¡ï¸ è¿‡å¤œå®‰å…¨äº‹ä»¶\nğŸš— é€šå‹¤è·¯å†µ\n\nè®¾ç½®å·²ä¿å­˜ã€‚', action: ()=>{ prefs.time='07:00'; savePrefs(); }},
  'commute:PAâ†’MV': { text:'ğŸš— å·²æ·»åŠ é€šå‹¤è·¯å†µï¼æ¯æ—¥é€Ÿè§ˆå°†åŒ…å« <strong>Palo Alto â†’ Mountain View</strong>ï¼š\n\nâ€¢ El Camino / Hwy 101 / Central Expy\nâ€¢ é¢„è®¡é€šå‹¤æ—¶é—´\nâ€¢ é‡å¤§äº‹æ•…é¢å¤–æ¨é€\n\nè®¾ç½®å·²ä¿å­˜ã€‚', action: ()=>{ prefs.commute='PAâ†’MV'; savePrefs(); document.getElementById('commuteBox').style.display='flex'; document.getElementById('commuteRoute').textContent='PAâ†’MV'; }},
  'topic:pet': { text:'ğŸ¾ å·²å¼€å¯å® ç‰©é¢‘é“ï¼å°†è¿½è¸ªï¼š\n\nâ€¢ Pets In Need æ–°åˆ°é¢†å…»å® ç‰©\nâ€¢ ç¤¾åŒºèµ°å¤±å® ç‰©å…¬å‘Š\nâ€¢ å…è´¹é¢†å…»æ´»åŠ¨\n\nç›®å‰PAæœ‰ä¸€åªAmerican Eskimoè¿·ä½ å‹æ­£åœ¨å¯»æ‰¾æ–°å®¶ï¼\n\nè®¾ç½®å·²ä¿å­˜ã€‚', action: ()=>{ addTopic('pet'); }},
  'topic:realestate': { text:'ğŸ  å·²å¼€å¯æˆ¿äº§å‘¨æŠ¥ï¼æ¯å‘¨æ¨é€ï¼š\n\nâ€¢ æˆ¿ä»·ä¸­ä½æ•°å’Œè¶‹åŠ¿\nâ€¢ æ–°ä¸Šå¸‚æˆ¿æº\nâ€¢ æˆäº¤äº®ç‚¹\nâ€¢ åˆ©ç‡å˜åŒ–\n\nè®¾ç½®å·²ä¿å­˜ã€‚', action: ()=>{ addTopic('realestate'); }},
  'topic:gov': { text:'ğŸ›ï¸ å·²å¼€å¯æ”¿åºœåŠ¨æ€ï¼å°†è¿½è¸ªï¼š\n\nâ€¢ å¸‚è®®ä¼šæŠ•ç¥¨å†³è®®\nâ€¢ Zoningå˜æ›´\nâ€¢ é¢„ç®—å’Œç¨åŠ¡\nâ€¢ å…¬å…±å¬è¯ä¼š\n\nè®¾ç½®å·²ä¿å­˜ã€‚', action: ()=>{ addTopic('gov'); }},
};

function addTopic(t) {
  if (!prefs.topics.includes(t)) prefs.topics.push(t);
  savePrefs();
  // Show card
  document.querySelectorAll(`#dashCards .card[data-card="${t}"]`).forEach(c => c.classList.remove('hidden'));
  // Update tags
  const tagMap = {weather:'ğŸŒ¤ï¸å¤©æ°”',safety:'ğŸ›¡ï¸å®‰å…¨',school:'ğŸ«å­¦åŒº',realestate:'ğŸ æˆ¿äº§',events:'ğŸ“…æ´»åŠ¨',business:'ğŸªå•†å®¶',podcast:'ğŸ™ï¸æ’­å®¢',gov:'ğŸ›ï¸æ”¿åºœ',pet:'ğŸ¾å® ç‰©'};
  const tag = document.createElement('span');
  tag.className = 'dash-pref-tag';
  tag.textContent = tagMap[t];
  document.getElementById('dashPrefs').appendChild(tag);
  showToast('âœ… å·²æ·»åŠ åˆ°ä½ çš„é¦–é¡µ');
}

function applySchoolFilter() {
  document.getElementById('schoolFilterTag').style.display = 'block';
  document.getElementById('schoolFilterName').textContent = prefs.school;
  document.getElementById('schoolBadge').textContent = prefs.school;
  showToast('ğŸ¯ å­¦åŒºè¿½è¸ªå·²æ›´æ–°');
}

function openChat() { document.getElementById('chatOverlay').classList.add('show'); }
function closeChat() { document.getElementById('chatOverlay').classList.remove('show'); }

function sendChip(el) {
  const text = el.textContent;
  const action = el.dataset.action;
  el.style.display = 'none';
  addMsg(text, 'user');
  showTyping();
  setTimeout(() => {
    hideTyping();
    const r = responses[action];
    const respText = r ? r.text.replace(/\n/g,'<br>') : 'âœ… å·²è®°å½•ï¼Œä¸‹æ¬¡æ¨é€ä¸­ç”Ÿæ•ˆï¼';
    addMsg(respText, 'bot');
    if (r && r.action) r.action();
    // Save chat history
    prefs.chatHistory.push({type:'user',text});
    prefs.chatHistory.push({type:'bot',text:respText});
    savePrefs();
  }, 1200+Math.random()*800);
}

function sendMsg() {
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  if (!text) return;
  input.value = '';
  addMsg(text, 'user');
  showTyping();

  // Simple keyword matching for dynamic responses
  let resp = 'âœ… æ˜ç™½ï¼æˆ‘å·²æ›´æ–°ä½ çš„åå¥½è®¾ç½®ï¼Œä¸‹æ¬¡æ¨é€ä¸­ç”Ÿæ•ˆã€‚';
  let action = null;

  if (text.match(/gunn|ç”˜æ©/i)) {
    resp = responses['school:Gunn High School'].text.replace(/\n/g,'<br>');
    action = responses['school:Gunn High School'].action;
  } else if (text.match(/é€šå‹¤|commute|è·¯å†µ/i)) {
    resp = responses['commute:PAâ†’MV'].text.replace(/\n/g,'<br>');
    action = responses['commute:PAâ†’MV'].action;
  } else if (text.match(/å® ç‰©|pet|ç‹—|çŒ«|é¢†å…»/i)) {
    resp = responses['topic:pet'].text.replace(/\n/g,'<br>');
    action = responses['topic:pet'].action;
  } else if (text.match(/æˆ¿äº§|æˆ¿ä»·|house|real estate/i)) {
    resp = responses['topic:realestate'].text.replace(/\n/g,'<br>');
    action = responses['topic:realestate'].action;
  } else if (text.match(/æ”¿åºœ|gov|å¸‚è®®ä¼š|zoning/i)) {
    resp = responses['topic:gov'].text.replace(/\n/g,'<br>');
    action = responses['topic:gov'].action;
  } else if (text.match(/åˆ é™¤|ç§»é™¤|ä¸è¦|å–æ¶ˆ|remove|hide/i)) {
    resp = 'âœ… å·²ä»ä½ çš„é¦–é¡µç§»é™¤ã€‚ä½ éšæ—¶å¯ä»¥åœ¨è¿™é‡Œé‡æ–°å¼€å¯ã€‚';
  }

  setTimeout(() => {
    hideTyping();
    addMsg(resp, 'bot');
    if (action) action();
    prefs.chatHistory.push({type:'user',text});
    prefs.chatHistory.push({type:'bot',text:resp});
    savePrefs();
  }, 1500);
}

function addMsg(text, type) {
  const msgs = document.getElementById('chatMsgs');
  const div = document.createElement('div');
  div.className = 'chat-msg ' + type;
  div.innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
}

function showTyping() { document.getElementById('chatTyping').style.display='block'; document.getElementById('chatMsgs').scrollTop = document.getElementById('chatMsgs').scrollHeight; }
function hideTyping() { document.getElementById('chatTyping').style.display='none'; }

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

document.getElementById('chatOverlay').addEventListener('click', function(e) { if(e.target===this) closeChat(); });
</script>

</body>
</html>
